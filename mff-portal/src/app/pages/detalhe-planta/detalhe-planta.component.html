<div class="detalhe-container"
  *ngIf="planta$ | async as planta; else loadingOrNotFound">

  <div class="detalhe-card" @fadeIn>

    <a routerLink="/flora" class="back-button">
      <mat-icon>arrow_back</mat-icon>
      Voltar para a Flora
    </a>

    <div class="detalhe-grid">

      <div class="coluna-media">
        <div class="imagem-wrapper">
          <img
            [src]="planta.fotoIndividuo || planta.fotoTaxonomia || 'assets/placeholder-image.png'"
            [alt]="'Foto de ' + planta.nomePopular"
            (error)="updateImageOnError($event)">
        </div>
        <div *ngIf="planta.trilhaAudio" class="audio-wrapper">
          <h3>Voz da Natureza</h3>
          <audio controls [src]="planta.trilhaAudio">
            Seu navegador não suporta o elemento de áudio.
          </audio>
        </div>
      </div>

      <div class="coluna-info">
        <div class="secao-detalhes">
          <h2 class="secao-titulo">Características Gerais</h2>
          <div class="detalhe-row">
            <span class="detalhe-label">Nome Popular</span>
            <span class="detalhe-value">{{ planta.nomePopular }}</span>
          </div>
          <div class="detalhe-row">
            <span class="detalhe-label">Nome Científico</span>
            <span class="detalhe-value"><em>{{ planta.nomeCientifico
                }}</em></span>
          </div>
          <div class="detalhe-row">
            <span class="detalhe-label">Família</span>
            <span class="detalhe-value">{{ planta.familia }}</span>
          </div>

          <h2 class="secao-titulo">Características Específicas</h2>
          <div class="detalhe-row">
            <span class="detalhe-label">Local</span>
            <span class="detalhe-value">{{ planta.nomeLocal }}</span>
          </div>
          <div *ngIf="planta.anoPlantio && planta.anoPlantio !== '0'"
            class="detalhe-row">
            <span class="detalhe-label">Ano de Plantio</span>
            <span class="detalhe-value">{{ planta.anoPlantio }}</span>
          </div>
          <div *ngIf="planta.altura && planta.altura !== '0.00'"
            class="detalhe-row">
            <span class="detalhe-label">Altura</span>
            <span class="detalhe-value">{{ planta.altura }} m</span>
          </div>
          <div *ngIf="planta.circunferencia && planta.circunferencia !== '0.00'"
            class="detalhe-row">
            <span class="detalhe-label">Circunferência</span>
            <span class="detalhe-value">{{ planta.circunferencia }} cm</span>
          </div>
          <div *ngIf="planta.diametro && planta.diametro !== '0.00'"
            class="detalhe-row">
            <span class="detalhe-label">Diâmetro</span>
            <span class="detalhe-value">{{ planta.diametro }} cm</span>
          </div>
          <div *ngIf="planta.diametro_copa && planta.diametro_copa !== '0.00'"
            class="detalhe-row">
            <span class="detalhe-label">Diâmetro da copa</span>
            <span class="detalhe-value">{{ planta.diametro_copa }} cm</span>
          </div>

        </div>
        <div *ngIf="planta.latitude && planta.longitude"class="secao-detalhes">
            <h2 class="secao-titulo">Localização</h2>
            <div class="mapa-container">
              <app-mapa-flora [plantasFiltradas]="[planta]"></app-mapa-flora>
            </div>
          </div>
      </div>
    </div>
  </div>

</div>

<ng-template #loadingOrNotFound>
  <div class="feedback-wrapper">
    <mat-spinner diameter="50" color="primary"></mat-spinner>
    <p class="feedback-message">Carregando dados da planta...</p>
  </div>
</ng-template>